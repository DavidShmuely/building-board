<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>×œ×•×— ××•×“×¢×•×ª ×—×›× - ×‘× ×™×™×Ÿ ×ª××¨</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Assistant', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #333;
      overflow: hidden;
      height: 100vh;
    }

    .container {
      display: grid;
      grid-template-rows: auto 1fr auto;
      height: 100vh;
      padding: 15px;
      gap: 15px;
    }

    /* Header */
    .header {
      background: linear-gradient(135deg, #667eea, #764ba2);
      border-radius: 16px;
      padding: 20px 30px;
      box-shadow: 0 8px 16px rgba(0,0,0,0.2);
      display: grid;
      grid-template-columns: auto 1fr auto;
      align-items: center;
      gap: 30px;
      color: white;
    }

    .logo-section {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .building-icon {
      width: 80px;
      height: 80px;
      background: white;
      border-radius: 12px;
      padding: 5px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.15);
      overflow: hidden;
    }

    .building-icon img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 8px;
    }

    .building-name {
      font-size: 24px;
      font-weight: 700;
    }

    .header-center {
      text-align: center;
    }

    .time {
      font-size: 56px;
      font-weight: 700;
      line-height: 1;
      font-variant-numeric: tabular-nums;
      text-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }

    .dates {
      margin-top: 8px;
      font-size: 18px;
      opacity: 0.95;
    }

    .date-hebrew {
      font-weight: 600;
      margin-left: 20px;
    }

    /* Weather Widget */
    .weather-widget {
      background: rgba(255,255,255,0.15);
      backdrop-filter: blur(10px);
      border-radius: 12px;
      padding: 15px 20px;
      min-width: 280px;
    }

    .weather-current {
      display: flex;
      align-items: center;
      gap: 15px;
      margin-bottom: 10px;
    }

    .weather-icon {
      font-size: 48px;
    }

    .weather-temp {
      font-size: 42px;
      font-weight: 700;
    }

    .weather-desc {
      font-size: 16px;
      opacity: 0.9;
    }

    .weather-forecast {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 10px;
      margin-top: 10px;
      padding-top: 10px;
      border-top: 1px solid rgba(255,255,255,0.2);
    }

    .forecast-item {
      text-align: center;
      font-size: 14px;
    }

    .forecast-day {
      opacity: 0.8;
      margin-bottom: 5px;
    }

    .forecast-icon {
      font-size: 24px;
      margin: 5px 0;
    }

    .forecast-temp {
      font-weight: 600;
    }

    /* Main Content */
    .main-content {
      display: grid;
      grid-template-columns: 2.5fr 1fr;
      gap: 15px;
    }

    .card {
      background: white;
      border-radius: 16px;
      padding: 25px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      overflow: hidden;
    }

    /* Central Area */
    .central-area {
      display: grid;
      grid-template-rows: auto 1fr;
      gap: 20px;
    }

    .zmanim-bar {
      background: linear-gradient(135deg, #f8f9fa, #e9ecef);
      border-radius: 12px;
      padding: 15px 20px;
      display: grid;
      grid-template-columns: repeat(6, 1fr);
      gap: 15px;
      border: 2px solid #667eea;
    }

    .zman-item {
      text-align: center;
    }

    .zman-label {
      font-size: 13px;
      color: #666;
      margin-bottom: 4px;
    }

    .zman-time {
      font-size: 18px;
      font-weight: 700;
      color: #667eea;
    }

    .central-notice {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
      background: linear-gradient(135deg, #fff5e6, #ffe6f0);
      border-radius: 12px;
      padding: 30px;
      transition: opacity 0.5s ease;
    }

    .notice-image {
      max-width: 300px;
      max-height: 300px;
      margin-bottom: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }

    .notice-title {
      font-size: 36px;
      font-weight: 700;
      color: #667eea;
      margin-bottom: 15px;
    }

    .notice-content {
      font-size: 24px;
      line-height: 1.5;
      color: #444;
    }

    /* Right Sidebar */
    .right-sidebar {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }

    .sidebar-section {
      background: white;
      border-radius: 16px;
      padding: 20px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }

    .section-title {
      font-size: 20px;
      font-weight: 700;
      color: #764ba2;
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 3px solid #764ba2;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .notice-list {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .notice-item {
      padding: 12px;
      background: linear-gradient(135deg, #f8f9fa, #fff);
      border-radius: 8px;
      border-right: 4px solid #667eea;
      transition: transform 0.2s;
    }

    .notice-item:hover {
      transform: translateX(-3px);
    }

    .notice-item-icon {
      font-size: 20px;
      margin-left: 8px;
    }

    .notice-item-title {
      font-weight: 600;
      font-size: 16px;
      color: #333;
      margin-bottom: 4px;
    }

    .notice-item-text {
      font-size: 14px;
      color: #666;
      line-height: 1.4;
    }

    /* Footer Ticker */
    .footer {
      background: linear-gradient(135deg, #2c3e50, #34495e);
      border-radius: 12px;
      padding: 15px 0;
      box-shadow: 0 -4px 12px rgba(0,0,0,0.2);
      overflow: hidden;
      position: relative;
    }

    .ticker-label {
      position: absolute;
      right: 20px;
      top: 50%;
      transform: translateY(-50%);
      background: #e74c3c;
      color: white;
      padding: 5px 15px;
      border-radius: 20px;
      font-weight: 700;
      font-size: 14px;
      z-index: 10;
    }

    .ticker-content {
      color: white;
      font-size: 20px;
      white-space: nowrap;
      padding-right: 100%;
      animation: ticker 30s linear infinite;
    }

    @keyframes ticker {
      0% { transform: translateX(100%); }
      100% { transform: translateX(-100%); }
    }

    /* Loading */
    .loading {
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100%;
      font-size: 20px;
      color: #999;
    }

    .error {
      background: #ef4444;
      color: white;
      padding: 20px;
      border-radius: 12px;
      text-align: center;
      margin: 20px;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Header -->
    <div class="header">
      <div class="logo-section">
        <div class="building-icon">
          <img id="buildingLogo" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='200' height='200'%3E%3Crect fill='%23f4e4c1' width='200' height='200'/%3E%3Ctext x='100' y='100' text-anchor='middle' dominant-baseline='middle' font-size='60' fill='%23d4924e'%3EğŸ¢%3C/text%3E%3C/svg%3E" alt="×œ×•×’×• ×‘× ×™×™×Ÿ">
        </div>
        <div class="building-name" id="buildingName">×˜×•×¢×Ÿ...</div>
      </div>

      <div class="header-center">
        <div class="time" id="time">00:00:00</div>
        <div class="dates">
          <span id="dateGregorian">×˜×•×¢×Ÿ...</span>
          <span class="date-hebrew" id="hebrewYear">×˜×•×¢×Ÿ...</span>
        </div>
      </div>

      <div class="weather-widget" id="weatherWidget">
        <div class="loading">×˜×•×¢×Ÿ...</div>
      </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
      <div class="central-area">
        <!-- Zmanim Bar -->
        <div class="zmanim-bar">
          <div class="zman-item">
            <div class="zman-label">×¢×œ×•×ª ×”×©×—×¨</div>
            <div class="zman-time" id="alot">--:--</div>
          </div>
          <div class="zman-item">
            <div class="zman-label">×”× ×¥ ×”×—××”</div>
            <div class="zman-time" id="sunrise">--:--</div>
          </div>
          <div class="zman-item">
            <div class="zman-label">×¡×•×£ ×–××Ÿ ×§×´×©</div>
            <div class="zman-time" id="shema">--:--</div>
          </div>
          <div class="zman-item">
            <div class="zman-label">×—×¦×•×ª</div>
            <div class="zman-time" id="chatzot">--:--</div>
          </div>
          <div class="zman-item">
            <div class="zman-label">×©×§×™×¢×”</div>
            <div class="zman-time" id="sunset">--:--</div>
          </div>
          <div class="zman-item">
            <div class="zman-label">×¦××ª ×›×•×›×‘×™×</div>
            <div class="zman-time" id="tzait">--:--</div>
          </div>
        </div>

        <!-- Central Notice -->
        <div class="card central-notice" id="centralNotice">
          <div class="loading">×˜×•×¢×Ÿ ×”×•×“×¢×•×ª...</div>
        </div>
      </div>

      <!-- Right Sidebar -->
      <div class="right-sidebar">
        <div class="sidebar-section">
          <div class="section-title">
            <span>ğŸ“¢</span>
            <span>×”×•×“×¢×•×ª ×œ×“×™×™×¨×™×</span>
          </div>
          <div class="notice-list" id="sideNotices">
            <div class="loading">×˜×•×¢×Ÿ...</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Footer Ticker -->
    <div class="footer">
      <div class="ticker-label">×—×“×©×•×ª</div>
      <div class="ticker-content" id="ticker">×˜×•×¢×Ÿ ×”×•×“×¢×•×ª...</div>
    </div>
  </div>

  <script>
    // ============= CONFIG - ×”-URL ×©×œ×š ×-Google Apps Script =============
    const GOOGLE_SHEET_URL = 'https://script.google.com/macros/s/AKfycbyeTnLiNB0edvktOLCMv4EzEc7MmrkQBQKgWcpURVIDYesr8cSHci_k6CpgkKHIep2aDg/exec';
    
    // ============= API KEYS =============
    // ×”×“×‘×§ ×›××Ÿ ××ª ×”-API Key ×©×œ×š ×-OpenWeatherMap
    const OPENWEATHER_API_KEY = '×”×“×‘×§_×›××Ÿ_API_KEY'; // Get from: https://openweathermap.org/api
    
    // ============= GLOBAL VARIABLES =============
    let CONFIG = {};
    let centralNotices = [];
    let sidebarNotices = [];
    let tickerMessages = [];
    let weatherData = null;
    let noticeIndex = 0;

    // ============= LOAD DATA FROM GOOGLE SHEETS =============
    async function loadDataFromSheets() {
      try {
        console.log('ğŸ”„ Loading data from Google Sheets...');
        
        const response = await fetch(GOOGLE_SHEET_URL);
        
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        const data = await response.json();
        
        if (data.error) {
          throw new Error(data.error);
        }
        
        console.log('âœ… Data loaded:', data);
        
        // Load all data
        CONFIG = data.config || {};
        centralNotices = data.central || [];
        sidebarNotices = data.sidebar || [];
        tickerMessages = data.ticker || [];
        weatherData = data.weather || null;
        
        // If zmanim is provided from Google Sheets, use it
        if (data.zmanim) {
          console.log('âœ… Using zmanim from Google Sheets');
          displayZmanimFromData(data.zmanim);
        }
        
        // Apply data to UI
        applyData();
        
      } catch (error) {
        console.error('âŒ Error loading data:', error);
        showError('×©×’×™××” ×‘×˜×¢×™× ×ª × ×ª×•× ×™× ×-Google Sheets: ' + error.message);
      }
    }
    
    // Display zmanim from Google Sheets data
    function displayZmanimFromData(zmanim) {
      document.getElementById('alot').textContent = zmanim.alot || '--:--';
      document.getElementById('sunrise').textContent = zmanim.sunrise || '--:--';
      document.getElementById('shema').textContent = zmanim.shema || '--:--';
      document.getElementById('chatzot').textContent = zmanim.chatzot || '--:--';
      document.getElementById('sunset').textContent = zmanim.sunset || '--:--';
      document.getElementById('tzait').textContent = zmanim.tzait || '--:--';
    }

    // ============= APPLY DATA TO UI =============
    function applyData() {
      console.log('ğŸ“‹ Applying data to UI...');
      
      // Header
      document.getElementById('buildingName').textContent = CONFIG.buildingName || '×‘× ×™×™×Ÿ ×ª××¨';
      document.getElementById('hebrewYear').textContent = CONFIG.hebrewYear || '×”×ª×©×¤×´×•';
      
      // Sidebar
      displaySidebar();
      
      // Ticker
      displayTicker();
      
      // Fetch real data from APIs
      fetchZmanimFromAPI();
      fetchWeatherFromAPI();
      
      // Start rotation
      rotateNotice();
      
      console.log('âœ… UI updated successfully');
    }

    // ============= FETCH ZMANIM - FIXED VERSION =============
    async function fetchZmanimFromAPI() {
      try {
        const lat = CONFIG.location?.lat || 32.089157;
        const lng = CONFIG.location?.lng || 34.887835;
        
        // Using hebcal API with correct parsing
        const url = `https://www.hebcal.com/zmanim?cfg=json&latitude=${lat}&longitude=${lng}&tzid=Asia/Jerusalem`;
        
        console.log('ğŸ• Fetching zmanim from hebcal.com...');
        
        const response = await fetch(url);
        const data = await response.json();
        
        console.log('âœ… Zmanim raw data:', data);
        
        // The API returns times in ISO format like "2026-01-21T05:32:00+02:00"
        // We need to extract ONLY the time part (HH:MM)
        
        const extractTime = (isoString) => {
          if (!isoString) return '--:--';
          
          // Parse the ISO string to Date object
          const date = new Date(isoString);
          
          // Format to HH:MM in local timezone
          return date.toLocaleTimeString('he-IL', { 
            hour: '2-digit', 
            minute: '2-digit',
            hour12: false,
            timeZone: 'Asia/Jerusalem'
          });
        };
        
        const times = data.times;
        
        // Update display with extracted times
        document.getElementById('alot').textContent = extractTime(times.alotHaShachar);
        document.getElementById('sunrise').textContent = extractTime(times.sunrise);
        document.getElementById('shema').textContent = extractTime(times.sofZmanShma);
        document.getElementById('chatzot').textContent = extractTime(times.chatzot);
        document.getElementById('sunset').textContent = extractTime(times.sunset);
        document.getElementById('tzait').textContent = extractTime(times.tzeit);
        
        console.log('âœ… Zmanim displayed correctly');
        
      } catch (error) {
        console.error('âŒ Error fetching zmanim:', error);
        console.log('âš ï¸ Trying alternative method...');
        
        // Try direct URL approach
        fetchZmanimDirect();
      }
    }
    
    // ============= DIRECT ZMANIM FETCH =============
    async function fetchZmanimDirect() {
      try {
        const lat = CONFIG.location?.lat || 32.089157;
        const lng = CONFIG.location?.lng || 34.887835;
        
        // Get today's date in YYYY-MM-DD format
        const today = new Date();
        const year = today.getFullYear();
        const month = String(today.getMonth() + 1).padStart(2, '0');
        const day = String(today.getDate()).padStart(2, '0');
        const dateStr = `${year}-${month}-${day}`;
        
        const url = `https://www.hebcal.com/zmanim?cfg=json&geonameid=293703&date=${dateStr}`;
        
        console.log('ğŸ• Trying direct hebcal fetch for:', dateStr);
        
        const response = await fetch(url);
        const data = await response.json();
        
        console.log('âœ… Direct zmanim:', data);
        
        // Parse times - they come as "HH:MM:SS" strings
        const parseTime = (timeStr) => {
          if (!timeStr) return '--:--';
          
          // If it's already in HH:MM:SS format, just take HH:MM
          if (timeStr.includes(':')) {
            return timeStr.substring(0, 5);
          }
          
          // If it's a full ISO string, parse it
          const date = new Date(timeStr);
          return date.toLocaleTimeString('he-IL', { 
            hour: '2-digit', 
            minute: '2-digit',
            hour12: false
          });
        };
        
        const times = data.times;
        
        document.getElementById('alot').textContent = parseTime(times.alotHaShachar);
        document.getElementById('sunrise').textContent = parseTime(times.sunrise);
        document.getElementById('shema').textContent = parseTime(times.sofZmanShma);
        document.getElementById('chatzot').textContent = parseTime(times.chatzot);
        document.getElementById('sunset').textContent = parseTime(times.sunset);
        document.getElementById('tzait').textContent = parseTime(times.tzeit);
        
        console.log('âœ… Direct zmanim displayed');
        
      } catch (error) {
        console.error('âŒ Direct fetch also failed:', error);
        
        // Final fallback - calculate locally
        calculateZmanim();
      }
    }

    // ============= FETCH WEATHER FROM OPENWEATHERMAP API =============
    async function fetchWeatherFromAPI() {
      try {
        // Check if API key is configured
        if (!OPENWEATHER_API_KEY || OPENWEATHER_API_KEY.includes('×”×“×‘×§_×›××Ÿ')) {
          console.warn('âš ï¸ OpenWeatherMap API key not configured, using demo data');
          displayWeather(); // Use data from Google Sheets
          return;
        }
        
        const lat = CONFIG.location?.lat || 32.089157;
        const lng = CONFIG.location?.lng || 34.887835;
        
        const url = `https://api.openweathermap.org/data/2.5/forecast?lat=${lat}&lon=${lng}&appid=${OPENWEATHER_API_KEY}&units=metric&lang=he&cnt=5`;
        
        console.log('ğŸŒ¤ï¸ Fetching weather from OpenWeatherMap...');
        const response = await fetch(url);
        const data = await response.json();
        
        if (data.cod !== '200') {
          throw new Error(data.message);
        }
        
        console.log('âœ… Weather received:', data);
        
        // Process forecast - take every 2nd item (6 hour intervals)
        const forecast = [];
        for (let i = 0; i < data.list.length; i += 2) {
          if (forecast.length >= 4) break;
          
          const item = data.list[i];
          const date = new Date(item.dt * 1000);
          
          // Map OpenWeather icon codes to emojis
          const iconMap = {
            '01d': 'â˜€ï¸', '01n': 'ğŸŒ™',
            '02d': 'â›…', '02n': 'â˜ï¸',
            '03d': 'â˜ï¸', '03n': 'â˜ï¸',
            '04d': 'â˜ï¸', '04n': 'â˜ï¸',
            '09d': 'ğŸŒ§ï¸', '09n': 'ğŸŒ§ï¸',
            '10d': 'ğŸŒ¦ï¸', '10n': 'ğŸŒ§ï¸',
            '11d': 'â›ˆï¸', '11n': 'â›ˆï¸',
            '13d': 'ğŸŒ¨ï¸', '13n': 'ğŸŒ¨ï¸',
            '50d': 'ğŸŒ«ï¸', '50n': 'ğŸŒ«ï¸'
          };
          
          forecast.push({
            day: date.toLocaleDateString('he-IL', { weekday: 'short' }),
            time: date.toLocaleTimeString('he-IL', { hour: '2-digit', minute: '2-digit' }),
            icon: iconMap[item.weather[0].icon] || 'ğŸŒ¤ï¸',
            temp: Math.round(item.main.temp)
          });
        }
        
        // Update weather data
        weatherData = {
          current: {
            temp: Math.round(data.list[0].main.temp),
            description: data.list[0].weather[0].description,
            icon: iconMap[data.list[0].weather[0].icon] || 'ğŸŒ¤ï¸'
          },
          forecast: forecast
        };
        
        displayWeather();
        
      } catch (error) {
        console.error('âŒ Error fetching weather:', error);
        // Fallback to data from Google Sheets
        displayWeather();
      }
    }

    // ============= DISPLAY FUNCTIONS =============
    function displayWeather() {
      if (!weatherData || !weatherData.current) return;
      
      let html = `
        <div class="weather-current">
          <div class="weather-icon">${weatherData.current.icon}</div>
          <div>
            <div class="weather-temp">${weatherData.current.temp}Â°</div>
            <div class="weather-desc">${weatherData.current.description}</div>
          </div>
        </div>
      `;
      
      if (weatherData.forecast && weatherData.forecast.length > 0) {
        html += '<div class="weather-forecast">';
        weatherData.forecast.forEach(item => {
          html += `
            <div class="forecast-item">
              <div class="forecast-day">${item.day} ${item.time || ''}</div>
              <div class="forecast-icon">${item.icon}</div>
              <div class="forecast-temp">${item.temp}Â°</div>
            </div>
          `;
        });
        html += '</div>';
      }
      
      document.getElementById('weatherWidget').innerHTML = html;
    }

    function displaySidebar() {
      const html = sidebarNotices.map(n => `
        <div class="notice-item">
          <div class="notice-item-title">
            <span class="notice-item-icon">${n.icon}</span>
            ${n.title}
          </div>
          <div class="notice-item-text">${n.text}</div>
        </div>
      `).join('');
      
      document.getElementById('sideNotices').innerHTML = html || '<div class="loading">××™×Ÿ ×”×•×“×¢×•×ª</div>';
    }

    function displayTicker() {
      const text = tickerMessages.join(' â€¢ ');
      document.getElementById('ticker').textContent = text + ' â€¢ ' + text;
    }

    function rotateNotice() {
      if (centralNotices.length === 0) {
        document.getElementById('centralNotice').innerHTML = '<div class="notice-title">××™×Ÿ ×”×•×“×¢×•×ª ×œ×”×¦×’×”</div>';
        return;
      }
      
      const el = document.getElementById('centralNotice');
      el.style.opacity = '0';
      
      setTimeout(() => {
        const notice = centralNotices[noticeIndex];
        let html = '';
        
        if (notice.image) {
          html += `<img src="${notice.image}" class="notice-image" alt="${notice.title}">`;
        }
        
        html += `
          <div class="notice-title">${notice.title}</div>
          <div class="notice-content">${notice.content}</div>
        `;
        
        el.innerHTML = html;
        el.style.opacity = '1';
        
        noticeIndex = (noticeIndex + 1) % centralNotices.length;
      }, 500);
      
      const interval = CONFIG.intervals?.centralNotice || 8000;
      setTimeout(rotateNotice, interval);
    }

    // ============= ZMANIM CALCULATION =============
    function calculateZmanim() {
      const now = new Date();
      const lat = CONFIG.location?.lat || 32.089157; // ×¤×ª×— ×ª×§×•×•×”
      const lng = CONFIG.location?.lng || 34.887835;
      
      const rad = Math.PI / 180;
      
      // Calculate day of year
      const start = new Date(now.getFullYear(), 0, 0);
      const diff = now - start;
      const oneDay = 1000 * 60 * 60 * 24;
      const dayOfYear = Math.floor(diff / oneDay);
      
      // Solar declination
      const declination = 23.45 * Math.sin(rad * (360 / 365.25) * (dayOfYear - 81));
      
      // Hour angle for sunrise/sunset
      const cosH = (Math.sin(-0.833 * rad) - Math.sin(lat * rad) * Math.sin(declination * rad)) / 
                   (Math.cos(lat * rad) * Math.cos(declination * rad));
      
      if (cosH > 1 || cosH < -1) {
        console.warn('No sunrise/sunset today');
        return;
      }
      
      const hourAngle = Math.acos(cosH) / rad;
      
      // Solar noon (adjusted for longitude and equation of time)
      const noon = 12 - lng / 15;
      
      // Sunrise and sunset
      const sunrise = noon - hourAngle / 15;
      const sunset = noon + hourAngle / 15;
      
      // Format time
      const fmt = h => {
        let hours = Math.floor(h);
        let mins = Math.floor((h - hours) * 60);
        
        // Handle overflow
        if (mins >= 60) {
          hours += 1;
          mins = 0;
        }
        if (hours >= 24) hours -= 24;
        if (hours < 0) hours += 24;
        
        return `${String(hours).padStart(2, '0')}:${String(mins).padStart(2, '0')}`;
      };
      
      // Calculate all zmanim
      document.getElementById('alot').textContent = fmt(sunrise - 1.2); // 72 minutes before
      document.getElementById('sunrise').textContent = fmt(sunrise);
      document.getElementById('shema').textContent = fmt(sunrise + 3); // 3 hours after sunrise
      document.getElementById('chatzot').textContent = fmt(noon);
      document.getElementById('sunset').textContent = fmt(sunset);
      document.getElementById('tzait').textContent = fmt(sunset + 0.75); // 45 minutes after
      
      console.log('âœ… Zmanim calculated for:', {lat, lng, date: now.toLocaleDateString('he-IL')});
    }

    // ============= CLOCK =============
    function updateClock() {
      const now = new Date();
      
      document.getElementById('time').textContent = now.toLocaleTimeString('he-IL', { 
        hour: '2-digit', 
        minute: '2-digit', 
        second: '2-digit',
        hour12: false 
      });
      
      document.getElementById('dateGregorian').textContent = now.toLocaleDateString('he-IL', { 
        weekday: 'long', 
        year: 'numeric', 
        month: 'long', 
        day: 'numeric' 
      });
    }

    // ============= ERROR DISPLAY =============
    function showError(message) {
      document.body.innerHTML = `
        <div class="error">
          <h2>âš ï¸ ×©×’×™××”</h2>
          <p>${message}</p>
          <p style="margin-top: 20px; font-size: 14px;">
            ×‘×“×•×§ ××ª ×”-URL ×©×œ Google Apps Script<br>
            ×•×©×”×¨×©××•×ª ××•×’×“×¨×•×ª ×œ-"Anyone"
          </p>
        </div>
      `;
    }

    // ============= INITIALIZATION =============
    console.log('ğŸš€ Initializing board...');
    
    // Start clock
    updateClock();
    setInterval(updateClock, 1000);
    
    // Load data from Google Sheets
    loadDataFromSheets();
    
    // Reload data every 5 minutes
    setInterval(loadDataFromSheets, 300000);
    
    // Update zmanim and weather every hour
    setInterval(() => {
      if (CONFIG.location) {
        fetchZmanimFromAPI();
        fetchWeatherFromAPI();
      }
    }, 3600000); // Every hour
    
    // Update zmanim daily at midnight
    const now = new Date();
    const msUntilMidnight = new Date(now.getFullYear(), now.getMonth(), now.getDate() + 1, 0, 0, 0) - now;
    setTimeout(() => {
      fetchZmanimFromAPI();
      // Then update daily
      setInterval(fetchZmanimFromAPI, 86400000);
    }, msUntilMidnight);
    
    console.log('âœ… Board initialized');
  </script>
</body>
</html>
