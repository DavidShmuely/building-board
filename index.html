<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>×œ×•×— ××•×“×¢×•×ª - ×‘× ×™×™×Ÿ ×ª××¨</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    /* Scrollbar styling */
    ::-webkit-scrollbar {
      width: 8px;
    }

    ::-webkit-scrollbar-track {
      background: rgba(0,0,0,0.05);
      border-radius: 10px;
    }

    ::-webkit-scrollbar-thumb {
      background: rgba(0,0,0,0.2);
      border-radius: 10px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: rgba(0,0,0,0.3);
    }

    body {
      font-family: 'Assistant', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #e8eef5;
      color: #333;
      overflow: hidden;
      height: 100vh;
      width: 100vw;
    }

    .container {
      display: grid;
      grid-template-rows: minmax(auto, 15vh) 1fr minmax(auto, 5vh);
      height: 100vh;
      overflow: hidden;
    }

    /* Header */
    .header {
      background: linear-gradient(135deg, #2c5aa0, #1e3a6d);
      padding: clamp(15px, 2vw, 25px) clamp(15px, 2vw, 30px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      display: grid;
      grid-template-columns: minmax(200px, 400px) 1fr minmax(200px, 400px);
      align-items: center;
      gap: clamp(15px, 2vw, 30px);
      color: white;
      position: relative;
      min-height: clamp(100px, 15vh, 150px);
    }

    .bsd {
      position: absolute;
      top: 10px;
      right: 10px;
      font-size: clamp(14px, 1.5vw, 18px);
      color: rgba(255,255,255,0.9);
      font-weight: 600;
    }

    .building-label {
      position: absolute;
      top: 0;
      right: 0;
      bottom: 0;
      width: clamp(150px, 25%, 300px);
      background: #1565c0;
      color: white;
      display: flex;
      flex-direction: row;
      align-items: center;
      justify-content: center;
      font-size: clamp(24px, 4vw, 48px);
      font-weight: 700;
      box-shadow: -4px 0 12px rgba(0,0,0,0.3);
      gap: clamp(8px, 1vw, 15px);
      border-radius: 0 0 0 20px;
      padding: clamp(10px, 1.5vw, 20px);
    }

    .building-label-logo {
      width: clamp(60px, 10vw, 120px);
      height: clamp(60px, 10vw, 120px);
      object-fit: contain;
      background: transparent;
      padding: 0px;
      border-radius: 15px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.2);
      border: 0px solid #f0a853;
    }

    .logo-section {
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .building-icon {
      width: clamp(50px, 8vw, 80px);
      height: clamp(50px, 8vw, 80px);
      background: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: clamp(24px, 4vw, 42px);
      box-shadow: 0 3px 10px rgba(0,0,0,0.2);
    }

    .header-center {
      text-align: center;
    }

    .time {
      font-size: clamp(36px, 6vw, 72px);
      font-weight: 800;
      line-height: 1;
      text-shadow: 0 3px 8px rgba(0,0,0,0.3);
    }

    .header-left {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      gap: clamp(4px, 0.5vw, 8px);
    }

    .date-hebrew {
      font-size: clamp(24px, 4vw, 48px);
      font-weight: 700;
      line-height: 1;
    }

    .date-gregorian {
      font-size: clamp(14px, 2vw, 24px);
      opacity: 0.9;
    }

    /* Main Content */
    .main-content {
      display: grid;
      grid-template-columns: minmax(250px, 1fr) minmax(400px, 2.5fr) minmax(250px, 1fr);
      gap: clamp(10px, 1.5vw, 15px);
      padding: clamp(10px, 1.5vw, 15px);
      overflow: hidden;
      height: 100%;
    }

    .left-sidebar {
      display: flex;
      flex-direction: column;
      gap: clamp(10px, 1.5vw, 15px);
      overflow-y: auto;
      overflow-x: hidden;
    }

    .right-sidebar {
      display: flex;
      flex-direction: column;
      gap: clamp(10px, 1.5vw, 15px);
      overflow-y: auto;
      overflow-x: hidden;
    }

    .card {
      background: white;
      border-radius: clamp(8px, 1vw, 12px);
      padding: clamp(12px, 1.5vw, 18px);
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    /* Weather Section */
    .weather-section {
      padding: 0;
      background: transparent;
    }

    .weather-container {
      width: 100%;
    }

    .weather-title {
      font-size: clamp(16px, 2vw, 20px);
      color: #1976d2;
      margin-bottom: clamp(10px, 1.5vw, 15px);
      display: flex;
      align-items: center;
      gap: clamp(6px, 0.8vw, 8px);
      font-weight: 700;
    }

    .weather-hourly {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
      gap: clamp(8px, 1vw, 12px);
    }

    .weather-hour-card {
      background: linear-gradient(135deg, #e3f2fd, #bbdefb);
      padding: clamp(10px, 1.5vw, 15px);
      border-radius: clamp(8px, 1vw, 12px);
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: clamp(6px, 0.8vw, 8px);
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      text-align: center;
    }

    .weather-hour-time {
      font-size: clamp(18px, 2.5vw, 26px);
      font-weight: 700;
      color: #1976d2;
    }

    .weather-hour-main {
      display: flex;
      align-items: center;
      gap: clamp(8px, 1vw, 12px);
      justify-content: center;
    }

    .weather-hour-icon {
      font-size: clamp(32px, 4vw, 48px);
    }

    .weather-hour-temp {
      font-size: clamp(28px, 3.5vw, 36px);
      font-weight: 700;
      color: #1976d2;
    }

    .weather-hour-details {
      font-size: clamp(16px, 2vw, 20px);
      color: #555;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: clamp(3px, 0.4vw, 4px);
      width: 100%;
      font-weight: 600;
    }

    .weather-detail-row {
      display: flex;
      align-items: center;
      gap: clamp(4px, 0.5vw, 5px);
      justify-content: center;
    }

    .zmanim-card {
      background: linear-gradient(135deg, #fff3e0, #ffe0b2);
    }

    .zmanim-card h3 {
      font-size: clamp(18px, 2.5vw, 26px);
      color: #e65100;
      margin-bottom: clamp(10px, 1.5vw, 15px);
      display: flex;
      align-items: center;
      gap: clamp(6px, 0.8vw, 8px);
    }

    .shabbat-card {
      background: linear-gradient(135deg, #e8eaf6, #c5cae9);
    }

    .shabbat-card h3 {
      font-size: clamp(18px, 2.5vw, 26px);
      color: #3f51b5;
      margin-bottom: clamp(10px, 1.5vw, 15px);
      display: flex;
      align-items: center;
      gap: clamp(6px, 0.8vw, 8px);
    }

    .zman-row {
      display: flex;
      justify-content: space-between;
      padding: clamp(4px, 0.6vw, 6px) 0;
      border-bottom: 1px solid rgba(230,81,0,0.1);
    }

    .zman-row:last-child {
      border-bottom: none;
    }

    .zman-label {
      font-size: clamp(16px, 2vw, 20px);
      color: #666;
    }

    .zman-time {
      font-size: clamp(16px, 2vw, 20px);
      font-weight: 700;
      color: #e65100;
    }

    .central-notice {
      background: linear-gradient(135deg, #fff5e6, #ffe6f0);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
      min-height: clamp(350px, 45vh, 600px);
      max-height: clamp(400px, 50vh, 650px);
      margin-bottom: clamp(10px, 1.5vw, 15px);
      overflow: hidden;
      padding: clamp(15px, 2vw, 25px);
    }

    .notice-title {
      font-size: clamp(28px, 5vw, 50px);
      font-weight: 700;
      color: #667eea;
      margin-bottom: clamp(8px, 1vw, 12px);
      line-height: 1.2;
    }

    .notice-content {
      font-size: clamp(22px, 4vw, 40px);
      color: #444;
      line-height: 1.4;
      padding: 0 clamp(10px, 1.5vw, 15px);
    }

    .sidebar-section h3 {
      font-size: clamp(18px, 2.5vw, 26px);
      color: #764ba2;
      margin-bottom: clamp(10px, 1.5vw, 15px);
      padding-bottom: clamp(8px, 1vw, 10px);
      border-bottom: 2px solid #764ba2;
    }

    .notice-item {
      padding: clamp(15px, 2vw, 20px);
      background: #f8f9fa;
      border-radius: clamp(6px, 0.8vw, 8px);
      margin-bottom: clamp(8px, 1vw, 10px);
      border-right: 3px solid #667eea;
    }

    .notice-item-title {
      font-size: clamp(18px, 2.5vw, 24px);
      font-weight: 600;
      margin-bottom: clamp(4px, 0.5vw, 5px);
    }

    .notice-item div:last-child {
      font-size: clamp(16px, 2vw, 22px);
    }

    /* Footer */
    .footer {
      background: linear-gradient(135deg, #2c3e50, #34495e);
      color: white;
      padding: clamp(10px, 1.5vw, 15px);
      text-align: center;
      font-size: clamp(16px, 2vw, 22px);
    }

    /* Responsive breakpoints */
    @media (max-width: 1200px) {
      .main-content {
        grid-template-columns: minmax(200px, 1fr) minmax(350px, 2fr) minmax(200px, 1fr);
      }
      
      .weather-hourly {
        grid-template-columns: repeat(3, 1fr);
      }
    }

    @media (max-width: 900px) {
      .header {
        grid-template-columns: 1fr;
        grid-template-rows: auto auto auto;
        text-align: center;
      }

      .header-left {
        align-items: center;
      }

      .building-label {
        position: static;
        width: 100%;
        border-radius: 0;
      }

      .main-content {
        grid-template-columns: 1fr;
        grid-template-rows: auto auto auto;
      }

      .weather-hourly {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    @media (max-width: 600px) {
      .building-label {
        flex-direction: column;
      }

      .weather-hourly {
        grid-template-columns: 1fr;
      }

      .central-notice {
        min-height: 200px;
      }
    }

    /* Portrait orientation adjustments */
    @media (orientation: portrait) {
      .container {
        grid-template-rows: auto 1fr auto;
      }

      .main-content {
        overflow-y: auto;
      }
    }

    /* Landscape orientation adjustments */
    @media (orientation: landscape) and (max-height: 600px) {
      .header {
        min-height: 80px;
        padding: 10px 15px;
      }

      .central-notice {
        min-height: 200px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Header -->
    <div class="header">
      <div class="building-label">
        <img src="" alt="×ª××¨" class="building-label-logo">
        <span>×‘× ×™×™×Ÿ <br>×ª××¨</span>
      </div>
      <div class="bsd">×‘×¡"×“</div>
      <div class="logo-section">
        <div class="building-icon">ğŸ¢</div>
      </div>

      <div class="header-center">
        <div class="time" id="time">10:15:42</div>
      </div>

      <div class="header-left">
        <div class="date-hebrew" id="dateHebrew">×›"×‘ ×©×‘×˜ ×”×ª×©×¤"×•</div>
        <div class="date-gregorian" id="dateGreg">×™×•× ×¨×‘×™×¢×™, 22 ×‘×™× ×•××¨ 2026</div>
      </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
      <!-- Right Sidebar: Notices -->
      <div class="right-sidebar">
        <div class="sidebar-section card">
          <h3>ğŸ“¢ ×”×•×“×¢×•×ª ×œ×“×™×™×¨×™×</h3>
          <!-- Notices will be loaded from Google Sheets -->
        </div>
      </div>

      <!-- Center: Main Notice + Weather -->
      <div style="display: flex; flex-direction: column; height: 100%; overflow-y: auto; overflow-x: hidden;">
        <div class="card central-notice">
          <div class="notice-title" id="centralTitle">×˜×•×¢×Ÿ...</div>
          <div class="notice-content" id="centralContent">×˜×•×¢×Ÿ × ×ª×•× ×™× ××”×©×¨×ª...</div>
        </div>

        <!-- Weather Section -->
        <div class="weather-section">
          <div class="weather-container">
            <div class="weather-hourly" id="weatherHourly">
              <div class="weather-hour-card">
                <div class="weather-hour-time">×˜×•×¢×Ÿ...</div>
                <div class="weather-hour-main">
                  <div class="weather-hour-icon">â³</div>
                  <div class="weather-hour-temp">--Â°</div>
                </div>
                <div class="weather-hour-details">
                  <div class="weather-detail-row">
                    <span>ğŸ’¨</span>
                    <span>-- ×§×"×©</span>
                  </div>
                  <div class="weather-detail-row">
                    <span>ğŸ’§</span>
                    <span>--%</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Left Sidebar: Zmanim -->
      <div class="left-sidebar">
        <div class="card zmanim-card">
          <h3>ğŸ• ×–×× ×™ ×”×™×•×</h3>
          <div class="zman-row">
            <span class="zman-label">×¢×œ×•×ª ×”×©×—×¨</span>
            <span class="zman-time">--:--</span>
          </div>
          <div class="zman-row">
            <span class="zman-label">× ×¥ ×”×—××”</span>
            <span class="zman-time">--:--</span>
          </div>
          <div class="zman-row">
            <span class="zman-label">×¡×•×£ ×–××Ÿ ×§×´×© ××’×´×</span>
            <span class="zman-time">--:--</span>
          </div>
          <div class="zman-row">
            <span class="zman-label">×¡×•×£ ×–××Ÿ ×§×´×© ×’×¨×´×</span>
            <span class="zman-time">--:--</span>
          </div>
          <div class="zman-row">
            <span class="zman-label">×¡×•×£ ×–××Ÿ ×ª×¤×™×œ×” ××’×´×</span>
            <span class="zman-time">--:--</span>
          </div>
          <div class="zman-row">
            <span class="zman-label">×¡×•×£ ×–××Ÿ ×ª×¤×™×œ×” ×’×¨×´×</span>
            <span class="zman-time">--:--</span>
          </div>
          <div class="zman-row">
            <span class="zman-label">×—×¦×•×ª</span>
            <span class="zman-time">--:--</span>
          </div>
          <div class="zman-row">
            <span class="zman-label">×× ×—×” ×’×“×•×œ×”</span>
            <span class="zman-time">--:--</span>
          </div>
          <div class="zman-row">
            <span class="zman-label">×× ×—×” ×§×˜× ×”</span>
            <span class="zman-time">--:--</span>
          </div>
          <div class="zman-row">
            <span class="zman-label">×¤×œ×’ ×”×× ×—×”</span>
            <span class="zman-time">--:--</span>
          </div>
          <div class="zman-row">
            <span class="zman-label">×©×§×™×¢×”</span>
            <span class="zman-time">--:--</span>
          </div>
          <div class="zman-row">
            <span class="zman-label">×¦××ª ×”×›×•×›×‘×™×</span>
            <span class="zman-time">--:--</span>
          </div>
        </div>

        <!-- Shabbat Times Card -->
        <div class="card shabbat-card">
          <h3>ğŸ•¯ï¸ <span id="parashaName">×–×× ×™ ×©×‘×ª</span></h3>
          <div class="zman-row">
            <span class="zman-label">×›× ×™×¡×ª ×©×‘×ª</span>
            <span class="zman-time" id="shabbatCandles">--:--</span>
          </div>
          <div class="zman-row">
            <span class="zman-label">×™×¦×™××ª ×©×‘×ª</span>
            <span class="zman-time" id="shabbatEnd">--:--</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <div class="footer" id="footerText">
      ×˜×•×¢×Ÿ...
    </div>
  </div>

  <script>
    // Configuration - will be loaded from Google Sheets
    let latitude = 32.0853;
    let longitude = 34.8878;
    let buildingName = '×‘× ×™×™×Ÿ ×ª××¨';
    const OPENWEATHER_API_KEY = 'd6c0e81f9f6033ab44966be36d3d865f';

    // Central notice rotation
    let centralNotices = [];
    let currentCentralIndex = 0;
    let centralInterval = 10000;
    let tickerInterval = 300000;

    // Footer rotation
    let footerMessages = [];
    let currentFooterIndex = 0;
    let footerInterval = 10000;

    // Google Apps Script Web App URL
    const SHEETS_API_URL = 'https://script.google.com/macros/s/AKfycbyeTnLiNB0edvktOLCMv4EzEc7MmrkQBQKgWcpURVIDYesr8cSHci_k6CpgkKHIep2aDg/exec';

    function rotateCentralNotice() {
      if (centralNotices.length === 0) return;

      const notice = centralNotices[currentCentralIndex];
      const noticeTitle = document.getElementById('centralTitle');
      const noticeContent = document.getElementById('centralContent');

      if (noticeTitle && notice.title) {
        noticeTitle.innerHTML = notice.title;
      }
      if (noticeContent && notice.content) {
        noticeContent.innerHTML = notice.content;
      }

      currentCentralIndex = (currentCentralIndex + 1) % centralNotices.length;
    }

    function rotateFooter() {
      if (footerMessages.length === 0) return;

      const message = footerMessages[currentFooterIndex];
      const footerEl = document.getElementById('footerText');

      if (footerEl && message) {
        footerEl.textContent = message;
      }

      currentFooterIndex = (currentFooterIndex + 1) % footerMessages.length;
    }

    function applyStyles(styles) {
      if (!styles) return;

      if (styles.bodyBgColor) {
        document.body.style.background = styles.bodyBgColor;
      }

      if (styles.headerBgColor && styles.headerBgColor2) {
        const header = document.querySelector('.header');
        if (header) {
          header.style.background = `linear-gradient(135deg, ${styles.headerBgColor}, ${styles.headerBgColor2})`;
        }
      }

      if (styles.cardBgColor) {
        const cards = document.querySelectorAll('.card');
        cards.forEach(card => {
          card.style.background = styles.cardBgColor;
        });
      }

      if (styles.centralBgColor && styles.centralBgColor2) {
        const central = document.querySelector('.central-notice');
        if (central) {
          central.style.background = `linear-gradient(135deg, ${styles.centralBgColor}, ${styles.centralBgColor2})`;
        }
      }

      if (styles.weatherBgColor) {
        document.documentElement.style.setProperty('--weather-bg', styles.weatherBgColor);
      }

      if (styles.zmanimBgColor && styles.zmanimBgColor2) {
        const zmanimCard = document.querySelector('.zmanim-card');
        if (zmanimCard) {
          zmanimCard.style.background = `linear-gradient(135deg, ${styles.zmanimBgColor}, ${styles.zmanimBgColor2})`;
        }
      }

      if (styles.shabbatBgColor && styles.shabbatBgColor2) {
        const shabbatCard = document.querySelector('.shabbat-card');
        if (shabbatCard) {
          shabbatCard.style.background = `linear-gradient(135deg, ${styles.shabbatBgColor}, ${styles.shabbatBgColor2})`;
        }
      }

      if (styles.sidebarBgColor) {
        const sidebarSections = document.querySelectorAll('.sidebar-section');
        sidebarSections.forEach(section => {
          section.style.background = styles.sidebarBgColor;
        });
      }

      if (styles.footerBgColor && styles.footerBgColor2) {
        const footer = document.querySelector('.footer');
        if (footer) {
          footer.style.background = `linear-gradient(135deg, ${styles.footerBgColor}, ${styles.footerBgColor2})`;
        }
      }

      console.log('âœ… Styles applied from config');
    }

    async function loadConfigFromSheets() {
      try {
        console.log('ğŸ“Š Loading config from Google Sheets...');
        const response = await fetch(SHEETS_API_URL);

        if (!response.ok) {
          throw new Error('Network error');
        }

        const data = await response.json();

        if (data.error) {
          console.error('âŒ Error from Sheets:', data.error);
          return;
        }

        if (data.config) {
          if (data.config.buildingName) {
            buildingName = data.config.buildingName;
            const buildingLabel = document.querySelector('.building-label span');
            if (buildingLabel) {
              buildingLabel.innerHTML = `×‘× ×™×™×Ÿ <br>${buildingName.replace('×‘× ×™×™×Ÿ ', '')}`;
            }
          }

          if (data.config.location) {
            latitude = data.config.location.lat;
            longitude = data.config.location.lng;
            console.log('ğŸ“ Location updated:', latitude, longitude);

            updateWeather();
            getHebrewDateAndZmanim();
            getShabbatTimes();
          }

          if (data.config.centralInterval) {
            centralInterval = data.config.centralInterval * 1000;
            console.log('â±ï¸ Central interval updated:', centralInterval / 1000, 'seconds');

            if (window.centralRotationInterval) {
              clearInterval(window.centralRotationInterval);
            }
            if (centralNotices.length > 1) {
              window.centralRotationInterval = setInterval(rotateCentralNotice, centralInterval);
            }
          }

          if (data.config.tickerInterval) {
            tickerInterval = data.config.tickerInterval * 1000;
            console.log('ğŸ”„ Ticker interval updated:', tickerInterval / 1000, 'seconds');

            if (window.sheetsUpdateInterval) {
              clearInterval(window.sheetsUpdateInterval);
            }
            window.sheetsUpdateInterval = setInterval(loadConfigFromSheets, tickerInterval);
          }

          if (data.config.footerInterval) {
            footerInterval = data.config.footerInterval * 1000;
            console.log('â±ï¸ Footer interval updated:', footerInterval / 1000, 'seconds');

            if (window.footerRotationInterval) {
              clearInterval(window.footerRotationInterval);
            }
            if (footerMessages.length > 1) {
              window.footerRotationInterval = setInterval(rotateFooter, footerInterval);
            }
          }
        }

        if (data.footer && data.footer.length > 0) {
          footerMessages = data.footer;
          currentFooterIndex = 0;

          console.log(`ğŸ¦¶ Loaded ${footerMessages.length} footer message(s):`, footerMessages);

          rotateFooter();

          if (footerMessages.length > 1) {
            if (window.footerRotationInterval) {
              clearInterval(window.footerRotationInterval);
            }
            window.footerRotationInterval = setInterval(rotateFooter, footerInterval);
            console.log(`ğŸ”„ Footer rotation started (${footerMessages.length} messages, ${footerInterval / 1000}s interval)`);
          } else {
            console.log('â„¹ï¸ Single footer message - no rotation needed');
          }
        } else {
          const footerEl = document.getElementById('footerText');
          if (footerEl && footerEl.textContent === '×˜×•×¢×Ÿ...') {
            footerEl.textContent = '×©××™×¨×” ×¢×œ ×”× ×™×§×™×•×Ÿ ×‘××¨×—×‘×™× ×”××©×•×ª×¤×™× - ×ª×•×“×” ×¨×‘×”! ğŸ§¹';
          }
        }

        if (data.central && data.central.length > 0) {
          centralNotices = data.central;
          currentCentralIndex = 0;

          console.log(`ğŸ“° Loaded ${centralNotices.length} central notice(s):`, centralNotices);

          rotateCentralNotice();

          if (centralNotices.length > 1) {
            if (window.centralRotationInterval) {
              clearInterval(window.centralRotationInterval);
            }
            window.centralRotationInterval = setInterval(rotateCentralNotice, centralInterval);
            console.log(`ğŸ”„ Central notice rotation started (${centralNotices.length} notices, ${centralInterval / 1000}s interval)`);
          } else {
            console.log('â„¹ï¸ Single central notice - no rotation needed');
          }
        }

        if (data.sidebar && data.sidebar.length > 0) {
          const sidebarSection = document.querySelector('.sidebar-section.card');
          if (sidebarSection) {
            const h3 = sidebarSection.querySelector('h3');

            sidebarSection.innerHTML = '';
            if (h3) {
              sidebarSection.appendChild(h3);
            } else {
              const newH3 = document.createElement('h3');
              newH3.textContent = 'ğŸ“¢ ×”×•×“×¢×•×ª ×œ×“×™×™×¨×™×';
              sidebarSection.appendChild(newH3);
            }

            data.sidebar.forEach(notice => {
              const noticeDiv = document.createElement('div');
              noticeDiv.className = 'notice-item';
              noticeDiv.innerHTML = `
                <div class="notice-item-title">${notice.icon} ${notice.title}</div>
                <div>${notice.text}</div>
              `;
              sidebarSection.appendChild(noticeDiv);
            });

            console.log('ğŸ“‹ Sidebar notices updated');
          }
        }

        if (data.config && data.config.styles) {
          applyStyles(data.config.styles);
        }

        console.log('âœ… Config loaded successfully');
      } catch (error) {
        console.error('âŒ Error loading config from Sheets:', error);
        console.log('â„¹ï¸ Using default values / offline mode');

        const noticeTitle = document.getElementById('centralTitle');
        const noticeContent = document.getElementById('centralContent');

        if (noticeTitle && noticeTitle.textContent === '×˜×•×¢×Ÿ...') {
          noticeTitle.textContent = 'ğŸ“¡ ××™×Ÿ ×—×™×‘×•×¨';
        }
        if (noticeContent && noticeContent.textContent === '×˜×•×¢×Ÿ × ×ª×•× ×™× ××”×©×¨×ª...') {
          noticeContent.textContent = '×”×œ×•×— ×¤×•×¢×œ ×‘××¦×‘ ×œ× ××§×•×•×Ÿ';
        }

        const sidebarSection = document.querySelector('.sidebar-section.card');
        if (sidebarSection && sidebarSection.children.length <= 1) {
          const noticeDiv = document.createElement('div');
          noticeDiv.className = 'notice-item';
          noticeDiv.innerHTML = `
            <div class="notice-item-title">ğŸ“¡ ××¦×‘ ×œ× ××§×•×•×Ÿ</div>
            <div>×”× ×ª×•× ×™× ×™×¢×•×“×›× ×• ×›×©×”×—×™×‘×•×¨ ×™×—×–×•×¨</div>
          `;
          sidebarSection.appendChild(noticeDiv);
        }
      }
    }

    function getWeatherIcon(weatherCode) {
      const iconMap = {
        '01d': 'â˜€ï¸', '01n': 'ğŸŒ™',
        '02d': 'ğŸŒ¤ï¸', '02n': 'â˜ï¸',
        '03d': 'â˜ï¸', '03n': 'â˜ï¸',
        '04d': 'â˜ï¸', '04n': 'â˜ï¸',
        '09d': 'ğŸŒ§ï¸', '09n': 'ğŸŒ§ï¸',
        '10d': 'ğŸŒ¦ï¸', '10n': 'ğŸŒ§ï¸',
        '11d': 'â›ˆï¸', '11n': 'â›ˆï¸',
        '13d': 'â„ï¸', '13n': 'â„ï¸',
        '50d': 'ğŸŒ«ï¸', '50n': 'ğŸŒ«ï¸'
      };
      return iconMap[weatherCode] || 'ğŸŒ¤ï¸';
    }

    async function updateWeather() {
      try {
        const weatherUrl = `https://api.openweathermap.org/data/2.5/forecast?lat=${latitude}&lon=${longitude}&units=metric&appid=${OPENWEATHER_API_KEY}&lang=he`;
        const response = await fetch(weatherUrl);

        if (!response.ok) {
          throw new Error('Network error');
        }

        const data = await response.json();

        if (data.list && data.list.length > 0) {
          const weatherContainer = document.getElementById('weatherHourly');
          weatherContainer.innerHTML = '';

          const hours = [0, 3, 6, 9, 12, 15];

          hours.forEach(offset => {
            const targetIndex = Math.floor(offset / 3);
            if (data.list[targetIndex]) {
              const forecast = data.list[targetIndex];
              const forecastDate = new Date(forecast.dt * 1000);
              const timeStr = offset === 0 ? '×¢×›×©×™×•' : forecastDate.toLocaleTimeString('he-IL', { hour: '2-digit', minute: '2-digit', hour12: false });
              const temp = Math.round(forecast.main.temp);
              const windSpeed = Math.round(forecast.wind.speed * 3.6);
              const rainProb = forecast.pop ? Math.round(forecast.pop * 100) : 0;
              const icon = getWeatherIcon(forecast.weather[0].icon);

              const card = document.createElement('div');
              card.className = 'weather-hour-card';
              card.innerHTML = `
                <div class="weather-hour-time">${timeStr}</div>
                <div class="weather-hour-main">
                  <div class="weather-hour-icon">${icon}</div>
                  <div class="weather-hour-temp">${temp}Â°</div>
                </div>
                <div class="weather-hour-details">
                  <div class="weather-detail-row">
                    <span>ğŸ’¨</span>
                    <span>${windSpeed} ×§×"×©</span>
                  </div>
                  <div class="weather-detail-row">
                    <span>ğŸ’§</span>
                    <span>${rainProb}%</span>
                  </div>
                </div>
              `;
              weatherContainer.appendChild(card);
            }
          });
        }
      } catch (error) {
        console.error('Error fetching weather:', error);
        const weatherContainer = document.getElementById('weatherHourly');
        weatherContainer.innerHTML = '';

        const hours = ['×¢×›×©×™×•', '+3h', '+6h', '+9h', '+12h', '+15h'];
        hours.forEach(timeLabel => {
          const card = document.createElement('div');
          card.className = 'weather-hour-card';
          card.innerHTML = `
            <div class="weather-hour-time">${timeLabel}</div>
            <div class="weather-hour-main">
              <div class="weather-hour-icon">ğŸŒ¤ï¸</div>
              <div class="weather-hour-temp">--Â°</div>
            </div>
            <div class="weather-hour-details">
              <div class="weather-detail-row">
                <span>ğŸ’¨</span>
                <span>-- ×§×"×©</span>
              </div>
              <div class="weather-detail-row">
                <span>ğŸ’§</span>
                <span>--%</span>
              </div>
            </div>
          `;
          weatherContainer.appendChild(card);
        });
      }
    }

    async function getHebrewDateAndZmanim() {
      try {
        const now = new Date();
        const year = now.getFullYear();
        const month = String(now.getMonth() + 1).padStart(2, '0');
        const day = String(now.getDate()).padStart(2, '0');

        console.log('ğŸ“… Fetching for:', `${year}-${month}-${day}`, 'Location:', latitude, longitude);

        const dateUrl = `https://www.hebcal.com/converter?cfg=json&gy=${year}&gm=${month}&gd=${day}&g2h=1`;
        const dateResponse = await fetch(dateUrl);

        if (!dateResponse.ok) {
          throw new Error('Network error');
        }

        const dateData = await dateResponse.json();

        const zmanimUrl = `https://www.hebcal.com/zmanim?cfg=json&latitude=${latitude}&longitude=${longitude}&date=${year}-${month}-${day}`;
        console.log('ğŸ”— URL:', zmanimUrl);

        const zmanimResponse = await fetch(zmanimUrl);

        if (!zmanimResponse.ok) {
          throw new Error('Network error');
        }

        const zmanimData = await zmanimResponse.json();

        if (zmanimData.times) {
          const times = zmanimData.times;

          console.log('â° Key times:', {
            sunset: times.sunset,
            beinHaShmashos: times.beinHaShmashos,
            tzeit: times.tzeit
          });

          const tzeitTime = new Date(times.beinHaShmashos || times.tzeit);
          const currentTime = new Date();

          let hebrewDateToShow = dateData.hebrew;

          if (currentTime > tzeitTime) {
            console.log('ğŸŒ™ After tzeit - showing tomorrow\'s Hebrew date');

            const tomorrow = new Date(now);
            tomorrow.setDate(tomorrow.getDate() + 1);
            const tomorrowYear = tomorrow.getFullYear();
            const tomorrowMonth = String(tomorrow.getMonth() + 1).padStart(2, '0');
            const tomorrowDay = String(tomorrow.getDate()).padStart(2, '0');

            const tomorrowDateUrl = `https://www.hebcal.com/converter?cfg=json&gy=${tomorrowYear}&gm=${tomorrowMonth}&gd=${tomorrowDay}&g2h=1`;
            const tomorrowDateResponse = await fetch(tomorrowDateUrl);
            const tomorrowDateData = await tomorrowDateResponse.json();

            if (tomorrowDateData.hebrew) {
              hebrewDateToShow = tomorrowDateData.hebrew;
            }
          }

          if (hebrewDateToShow) {
            document.getElementById('dateHebrew').textContent = hebrewDateToShow;
          }

          const zmanimElements = document.querySelectorAll('.zman-time');

          const displayTimes = [
            times.alotHaShachar,
            times.sunrise,
            times.sofZmanShmaMGA,
            times.sofZmanShma,
            times.sofZmanTfillaMGA,
            times.sofZmanTfilla,
            times.chatzot,
            times.minchaGedola,
            times.minchaKetana,
            times.plagHaMincha,
            times.sunset,
            times.beinHaShmashos
          ];

          zmanimElements.forEach((el, index) => {
            if (displayTimes[index]) {
              const time = new Date(displayTimes[index]);
              const timeStr = time.toLocaleTimeString('he-IL', {
                hour: '2-digit',
                minute: '2-digit',
                hour12: false
              });
              el.textContent = timeStr;
            }
          });

          console.log('âœ… Zmanim updated successfully');
        }
      } catch (error) {
        console.error('âŒ Error fetching data:', error);
        const zmanimElements = document.querySelectorAll('.zman-time');
        zmanimElements.forEach(el => {
          el.textContent = '--:--';
        });
        const hebrewDateEl = document.getElementById('dateHebrew');
        if (hebrewDateEl.textContent === '×›"×‘ ×©×‘×˜ ×”×ª×©×¤"×•') {
          hebrewDateEl.textContent = '--';
        }
      }
    }

    async function getShabbatTimes() {
      try {
        const shabbatUrl = `https://www.hebcal.com/shabbat?cfg=json&latitude=${latitude}&longitude=${longitude}&M=on`;
        console.log('ğŸ•¯ï¸ Shabbat URL:', shabbatUrl);

        const response = await fetch(shabbatUrl);

        if (!response.ok) {
          throw new Error('Network error');
        }

        const data = await response.json();

        if (data.items && data.items.length > 0) {
          let candleLighting = null;
          let havdalah = null;
          let parashaName = '';

          data.items.forEach(item => {
            if (item.category === 'candles') {
              candleLighting = new Date(item.date);
            } else if (item.category === 'havdalah') {
              havdalah = new Date(item.date);
            } else if (item.category === 'parashat') {
              parashaName = item.hebrew || item.title;
            }
          });

          if (candleLighting) {
            const candleTime = candleLighting.toLocaleTimeString('he-IL', {
              hour: '2-digit',
              minute: '2-digit',
              hour12: false
            });
            document.getElementById('shabbatCandles').textContent = candleTime;
          }

          if (havdalah) {
            const havdalahTime = havdalah.toLocaleTimeString('he-IL', {
              hour: '2-digit',
              minute: '2-digit',
              hour12: false
            });
            document.getElementById('shabbatEnd').textContent = havdalahTime;
          }

          if (parashaName) {
            document.getElementById('parashaName').textContent = `×¤×¨×©×ª ${parashaName}`;
          } else {
            document.getElementById('parashaName').textContent = '×–×× ×™ ×©×‘×ª';
          }

          console.log('âœ… Shabbat times updated');
        }
      } catch (error) {
        console.error('âŒ Error fetching Shabbat times:', error);
        document.getElementById('parashaName').textContent = '×–×× ×™ ×©×‘×ª';
        document.getElementById('shabbatCandles').textContent = '--:--';
        document.getElementById('shabbatEnd').textContent = '--:--';
      }
    }

    function updateClock() {
      const now = new Date();
      document.getElementById('time').textContent = now.toLocaleTimeString('he-IL', {
        hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: false
      });
      document.getElementById('dateGreg').textContent = now.toLocaleDateString('he-IL', {
        weekday: 'long', year: 'numeric', month: 'long', day: 'numeric'
      });
    }

    // Initialize
    loadConfigFromSheets();
    updateClock();
    getHebrewDateAndZmanim();
    getShabbatTimes();
    updateWeather();

    // Set intervals
    setInterval(updateClock, 1000);
    setInterval(getHebrewDateAndZmanim, 60 * 60 * 1000);
    setInterval(getShabbatTimes, 60 * 60 * 1000);
    setInterval(updateWeather, 30 * 60 * 1000);
    window.sheetsUpdateInterval = setInterval(loadConfigFromSheets, tickerInterval);
  </script>
</body>
</html>
